<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check Google Code</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
            text-align: center;
        }
        .code-box {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
            word-break: break-all; /* Ensures long codes wrap */
            text-align: left;
        }
        .success { color: #28a745; font-size: 1.2rem; }
        .error { color: #dc3545; font-size: 1.2rem; }
        .instructions { color: #6c757d; margin-top: 1rem; }
    </style>
</head>
<body>
    <h1>Google Auth Code Check</h1>

    <!-- Success/Error Status -->
    <div id="status" class="success">Checking for code...</div>

    <!-- Code Display Box (will show the code if found) -->
    <div id="codeDisplay" class="code-box">
        Waiting for Google to send the code...
    </div>

    <!-- Instructions -->
    <p class="instructions">
        If you see a code above, the GitHub page received it!
        If not, check your Google Console settings.
    </p>

    <script>
        // Get elements to update
        const statusElement = document.getElementById('status');
        const codeDisplayElement = document.getElementById('codeDisplay');

        // Step 1: Extract the "code" parameter from the browser's URL
        const urlParams = new URLSearchParams(window.location.search);
        const googleCode = urlParams.get('code'); // This pulls the code from the URL
        const googleError = urlParams.get('error');

        // Step 2: Check if a code was found and print it
        if (googleError) {
            // Case 1: Google sent an error (e.g., user canceled)
            statusElement.textContent = "❌ Error from Google";
            statusElement.className = "error";
            codeDisplayElement.innerHTML = `Error: ${googleError}<br><br>Description: ${urlParams.get('error_description') || "No additional details"}`;
        } else if (googleCode) {
            // Case 2: Code found! Print it on the page
            statusElement.textContent = "✅ Code received successfully!";
            statusElement.className = "success";
            codeDisplayElement.innerHTML = `
                <strong>Google Authorization Code:</strong><br><br>
                ${googleCode}<br><br>
                <strong>Next Step:</strong> Forwarding to Expo app...
            `;

            // Optional: Still forward to Expo (keep your original deep link logic)
            const EXPO_DEV_URL = "exp://192.168.5.4:8081"; // Replace with your Expo URL
            const expoDeepLink = `${EXPO_DEV_URL}?googleCode=${encodeURIComponent(googleCode)}`;
            
            // Auto-redirect to Expo after 3 seconds (so you have time to read the code)
            setTimeout(() => {
                window.location.href = expoDeepLink;
            }, 3000);
        } else {
            // Case 3: No code found (e.g., you opened the page directly)
            statusElement.textContent = "⚠️ No code found";
            statusElement.className = "error";
            codeDisplayElement.textContent = "The URL does not contain a Google authorization code. Please sign in from the Expo app.";
        }
    </script>
</body>
</html>
